# Лента постов с учётом просмотров и Hotness

## Описание проекта

Это простой PHP-проект с использованием SQLite, реализующий API и веб-интерфейс ленты постов с учётом:

- Сортировки по полю **hotness** (популярность поста, чем выше — тем интереснее).
- Исключения из ленты постов, которые пользователь уже видел.
- Исключения постов со слишком большим количеством просмотров (`total_views > 1000`).
- Учёта просмотра постов пользователем — каждый просмотр фиксируется в отдельной таблице.
- Пагинации ленты.

---

## Структура базы данных

- Таблица `posts` — хранит посты с такими полями, как:
  - `id` — уникальный идентификатор поста,
  - `title` — заголовок,
  - `content` — содержимое,
  - `hotness` — показатель популярности,
  - `total_views` — количество всех просмотров,
  - `created_at` — дата создания.

- Таблица `post_views` — хранит записи о том, какой пользователь и какой пост уже видел, чтобы исключать эти посты из ленты. Структура:
  - `id` — уникальный идентификатор записи,
  - `user_id` — уникальный идентификатор пользователя,
  - `post_id` — идентификатор поста,
  - `viewed_at` — время просмотра.

---

## Основные функции

- **Просмотр ленты постов** (`GET /posts` или `/`):
  - Принимает параметр `user_id` (по умолчанию `1`).
  - Возвращает список постов, отсортированных по убыванию `hotness`.
  - Исключает посты, которые пользователь уже видел.
  - Исключает посты с `total_views > 1000`.
  - Поддерживает пагинацию (`page`, `limit`).

- **Отметить пост как просмотренный** (`POST /api/posts/viewed`):
  - Принимает `user_id` и `post_id`.
  - Добавляет запись в таблицу `post_views`.
  - Увеличивает `total_views` у поста.

- **Заполнить базу тестовыми постами** (`POST /api/posts/seed`):
  - Запускает генерацию фейковых постов (3000).

- **Очистить базу данных** (`POST /api/posts/clear`):
  - Удаляет все посты и связанные просмотры.

---

## Установка и запуск

1. Клонируйте репозиторий:

```bash
git clone https://github.com/AlexRaff/vcru_repository.git
cd vcru_repository
````

2. Убедитесь, что у вас установлен PHP с PDO и SQLite.

3. Запустите веб-сервер, например встроенный в PHP:

```bash
php -S localhost:8777 -t public 
```

4. Перейдите в браузере по адресу:

```
http://localhost:8777/
```

---

## Использование

* По умолчанию при заходе на `/` лента постов показывается для пользователя с `user_id=1`.
* В веб-интерфейсе можно добавить id  пользователя в поле для выбора `user_id`, чтобы тестировать разных пользователей.
* Кнопки для заполнения и очистки базы вызывают соответствующие API-запросы.
* После заполнения базы постами — лента отобразит данные.
* При просмотре постов автоматически фиксируется факт просмотра и `total_views` увеличивается.

---

## Роуты API

| Метод | Путь                | Описание                         |
| ----- | ------------------- | -------------------------------- |
| GET   | `/` или `/posts`    | Лента постов с пагинацией        |
| POST  | `/api/posts/viewed` | Отметить пост как просмотренный  |
| POST  | `/api/posts/seed`   | Заполнить базу тестовыми постами |
| POST  | `/api/posts/clear`  | Очистить базу                    |

---

## Как работает учёт просмотров?

* При выдаче ленты исключаются посты, которые пользователь уже видел (проверка по таблице `post_views`).
* При вызове API `/api/posts/viewed` фиксируется просмотр поста конкретным пользователем.
* Увеличивается общее число просмотров `total_views` в таблице `posts`.
* Если число просмотров превысит 1000, пост перестанет показываться в ленте.
